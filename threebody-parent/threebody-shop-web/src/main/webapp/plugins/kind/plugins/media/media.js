KindEditor.plugin("media",function(r){var s=this,p="media",c=s.lang(p+"."),h=r.undef(s.allowMediaUpload,!0),m=r.undef(s.allowFileManager,!1),g=r.undef(s.formatUploadUrl,!0),v=r.undef(s.extraFileUploadParams,{}),f=r.undef(s.filePostName,"imgFile"),k=r.undef(s.uploadJson,s.basePath+"php/upload_json.php");s.plugin.media={edit:function(){var t,e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+c.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+c.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+c.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+c.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+c.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+c.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join(""),a=s.createDialog({name:p,width:450,height:230,title:s.lang(p),body:e,yesBtn:{name:s.lang("yes"),click:function(){var e=r.trim(l.val()),t=o.val(),a=d.val();"http://"==e||r.invalidUrl(e)?l[0].focus():/^\d*$/.test(t)?/^\d*$/.test(a)?(a=r.mediaImg(s.themesPath+"common/blank.gif",{src:e,type:r.mediaType(e),width:t,height:a,autostart:u[0].checked?"true":"false",loop:"true"}),s.insertHtml(a).hideDialog().focus()):d[0].focus():o[0].focus()}}}),i=a.div,l=r('[name="url"]',i),n=r('[name="viewServer"]',i),o=r('[name="width"]',i),d=r('[name="height"]',i),u=r('[name="autostart"]',i);l.val("http://"),h?(t=r.uploadbutton({button:r(".ke-upload-button",i)[0],fieldName:f,extraParams:v,url:r.addParam(k,"dir=media"),afterUpload:function(e){var t;a.hideLoading(),0===e.error&&(t=e.url,g&&(t=r.formatUrl(t,"absolute")),l.val(t),s.afterUpload&&s.afterUpload.call(s,t,e,p))},afterError:function(e){a.hideLoading(),s.errorDialog(e)}})).fileBox.change(function(e){a.showLoading(s.lang("uploadLoading")),t.submit()}):r(".ke-upload-button",i).hide(),m?n.click(function(e){s.loadPlugin("filemanager",function(){s.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(e){1<s.dialogs.length&&(r('[name="url"]',i).val(e),s.afterSelectFile&&s.afterSelectFile.call(s,e),s.hideDialog())}})})}):n.hide();e=s.plugin.getSelectedMedia();e&&(n=r.mediaAttrs(e.attr("data-ke-tag")),l.val(n.src),o.val(r.removeUnit(e.css("width"))||n.width||0),d.val(r.removeUnit(e.css("height"))||n.height||0),u[0].checked="true"===n.autostart),l[0].focus(),l[0].select()},delete:function(){s.plugin.getSelectedMedia().remove()}},s.clickToolbar(p,s.plugin.media.edit)});