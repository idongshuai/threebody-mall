KindEditor.plugin("insertfile",function(d){var s=this,f="insertfile",c=d.undef(s.allowFileUpload,!0),p=d.undef(s.allowFileManager,!1),g=d.undef(s.formatUploadUrl,!0),m=d.undef(s.uploadJson,s.basePath+"php/upload_json.php"),v=d.undef(s.extraFileUploadParams,{}),k=d.undef(s.filePostName,"imgFile"),b=s.lang(f+".");s.plugin.fileDialog=function(e){var l,a=d.undef(e.fileUrl,"http://"),i=d.undef(e.fileTitle,""),t=e.clickFn,e=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+b.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+b.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+b.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+b.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join(""),n=s.createDialog({name:f,width:450,title:s.lang(f),body:e,yesBtn:{name:s.lang("yes"),click:function(){var e=d.trim(r.val()),l=u.val();"http://"==e||d.invalidUrl(e)?r[0].focus():(""===d.trim(l)&&(l=e),t.call(s,e,l))}}}),o=n.div,r=d('[name="url"]',o),e=d('[name="viewServer"]',o),u=d('[name="title"]',o);c?(l=d.uploadbutton({button:d(".ke-upload-button",o)[0],fieldName:k,url:d.addParam(m,"dir=file"),extraParams:v,afterUpload:function(e){var l;n.hideLoading(),0===e.error&&(l=e.url,g&&(l=d.formatUrl(l,"absolute")),r.val(l),s.afterUpload&&s.afterUpload.call(s,l,e,f))},afterError:function(e){n.hideLoading(),s.errorDialog(e)}})).fileBox.change(function(e){n.showLoading(s.lang("uploadLoading")),l.submit()}):d(".ke-upload-button",o).hide(),p?e.click(function(e){s.loadPlugin("filemanager",function(){s.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(e){1<s.dialogs.length&&(d('[name="url"]',o).val(e),s.afterSelectFile&&s.afterSelectFile.call(s,e),s.hideDialog())}})})}):e.hide(),r.val(a),u.val(i),r[0].focus(),r[0].select()},s.clickToolbar(f,function(){s.plugin.fileDialog({clickFn:function(e,l){l='<a class="ke-insertfile" href="'+e+'" data-ke-src="'+e+'" target="_blank">'+l+"</a>";s.insertHtml(l).hideDialog().focus()}})})});